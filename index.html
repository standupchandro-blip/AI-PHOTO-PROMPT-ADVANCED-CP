<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompter</title>
    <!-- Home Screen/App Icon Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Prompter">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/1e40af/ffffff?text=AI">
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/1e40af/ffffff?text=AI">


    <!-- Minimal, self-contained CSS for high compatibility -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8;
            color: #333;
            min-height: 100vh;
        }
        .container {
            width: 90%; 
            max-width: 440px;
            background: #ffffff;
            margin: 20px auto; 
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }
        p {
            font-size: 14px;
            color: #6b7280;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #3b82f6;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        /* Styling for Input Fields */
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.2s;
            margin-top: 8px; 
            margin-bottom: 4px; 
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .form-group {
            margin-bottom: 20px;
        }
        /* Styling for Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 48%;
        }
        .btn-blue {
            background-color: #3b82f6;
            color: white;
            width: 100%;
        }
        .btn-blue:hover {
            background-color: #2563eb;
        }
        .btn-gray {
            background-color: #d1d5db;
            color: #374151;
        }
        .btn-green {
            background-color: #10b981;
            color: white;
            width: 100%;
            margin-top: 15px;
        }
        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
            width: 100%;
            margin-top: 10px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            margin-top: 20px;
        }
        .final-prompt-box {
            background-color: #f9fafb;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            color: #1f2937;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .hidden {
            display: none;
        }
        .step-container {
            /* Restoring min-height to ensure space, but keeping it small */
            min-height: 150px; 
        }
        .icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        
        /* Custom Radio/Checkbox Styling */
        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }
        .radio-grid input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .radio-grid label {
            display: block;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 400;
            font-size: 14px;
        }
        .radio-grid input[type="radio"]:checked + label {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
        }


        /* Toast Message */
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
        }
        
    </style>
</head>
<body>


    <div class="container">
        <h1>Prompter 🧠</h1>
        <p>Build the perfect prompt in 5 simple steps.</p>


        <!-- Progress Bar -->
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
        </div>
        <p id="progressText" style="text-align: right; margin-bottom: 20px;">Step 1 of 5</p>


        <!-- Step Content -->
        <div id="stepContainer" class="step-container">
            <!-- Content will be injected here -->
        </div>


        <!-- Navigation -->
        <div class="navigation">
            <button id="backBtn" class="btn btn-gray" onclick="navigateStep(-1)" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="m15 18-6-6 6-6"/></svg>
                Back
            </button>
            <button id="nextBtn" class="btn btn-blue" onclick="navigateStep(1)">
                Next
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="m9 18 6-6-6-6"/></svg>
            </button>
            <button id="finishBtn" class="btn btn-green hidden" onclick="restartPrompt()">
                Start Over
            </button>
        </div>
    </div>
    
    <!-- Message Box -->
    <div id="messageBox" class="message-box hidden"></div>


    <script>
        // --- State Management and Configuration ---
        const TOTAL_STEPS = 6; // Steps 1-5 + Review Step 6
        let currentStep = 1;
        const promptData = {
            subject: "", action: "",
            medium: "", customStyle: "",
            moodLighting: "", customLighting: "",
            composition: "", customComposition: "",
            finalMods: "8k, highly detailed, smooth, trending on ArtStation"
        };
        let aiEnhancementText = "";


        const STEPS_CONFIG = [
            { id: 1, title: "The Core Idea 🌟" },
            { id: 2, title: "Medium & Style 🎨" },
            { id: 3, title: "Mood & Lighting 💡" },
            { id: 4, title: "Composition 📐" },
            { id: 5, title: "Final Quality Boosters ✨" },
            { id: 6, title: "Review & Output 🚀" }
        ];


        // --- DOM Elements ---
        const stepContainer = document.getElementById('stepContainer');
        const backBtn = document.getElementById('backBtn');
        const nextBtn = document.getElementById('nextBtn');
        const finishBtn = document.getElementById('finishBtn');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const messageBox = document.getElementById('messageBox');
        
        // --- UI Helper Functions ---


        function showMessage(text, type = 'success', duration = 3000) {
            messageBox.innerHTML = text;
            
            // Set color based on type (green for success, red for error)
            messageBox.style.backgroundColor = type === 'error' ? '#ef4444' : (type === 'info' ? '#3b82f6' : '#10b981');
            
            messageBox.classList.remove('hidden');


            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, duration);
        }


        // --- Core Logic ---


        function updatePromptData(event) {
            const element = event.target;
            const key = element.id || element.name;
            
            if (element.type === 'radio') {
                promptData[element.name] = element.value.trim();
            } else {
                promptData[key] = element.value.trim();
            }
        }


        function generateBasePrompt() {
            const parts = [
                promptData.subject, promptData.action,
                promptData.medium, promptData.customStyle,
                promptData.moodLighting, promptData.customLighting,
                promptData.composition, promptData.customComposition,
                promptData.finalMods
            ];


            return parts
                .map(part => part.trim())
                .filter(part => part)
                .join(', ');
        }
        
        function getFinalPrompt() {
            const base = generateBasePrompt();
            if (aiEnhancementText.trim()) {
                return [base, aiEnhancementText.trim()].filter(t => t).join(', ');
            }
            return base;
        }
        
        function copyPrompt() {
            const promptToCopy = getFinalPrompt();
            if (!promptToCopy) {
                showMessage("Nothing to copy!", 'error');
                return;
            }


            // Standard DOM copy trick
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = promptToCopy;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            
            try {
                // document.execCommand('copy') is the most reliable way in sandbox environments
                document.execCommand('copy');
                showMessage('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/></svg>Prompt Copied Successfully!');
            } catch (err) {
                console.error('Copy command failed:', err);
                showMessage("Copy failed. Please manually select the text.", 'error');
            }
            
            document.body.removeChild(tempTextarea);
        }
        
        function restartPrompt() {
            // Reset all values to initial state
            Object.assign(promptData, {
                subject: "", action: "",
                medium: "", customStyle: "",
                moodLighting: "", customLighting: "",
                composition: "", customComposition: "",
                finalMods: "8k, highly detailed, smooth, trending on ArtStation"
            });
            aiEnhancementText = ""; // Clear AI text
            currentStep = 1;
            updateUI();
        }


        // --- Mock AI Enhancement Logic (Instant and Stable) ---


        function generateMockEnhancementText(subject) {
            const lowerSubject = subject.toLowerCase();
            
            if (lowerSubject.includes("dragon")) {
                return "Scales are obsidian black, reflecting the dim light of two massive, silver moons. Mist drifts across the ancient, moss-covered crags surrounding its lair. Eyes glow with internal, liquid gold fire. The air is thick with ozone and the scent of sulfur.";
            } else if (lowerSubject.includes("robot") || lowerSubject.includes("mech")) {
                return "The surface is matte charcoal aluminum, heavily weathered with rust streaks and rain erosion. Intricate wiring and hydraulic pistons are visible beneath fractured armor plating. Dust motes float in the beam of a single, powerful headlamp. Sharp metallic textures contrast with the smooth, polished pavement beneath its massive foot.";
            } else if (lowerSubject.includes("woman") || lowerSubject.includes("girl") || lowerSubject.includes("female")) {
                return "Soft focus on the background creates a deep bokeh effect, highlighting the subject. She wears a flowing linen dress and a silver locket reflecting the light. Her expression is one of calm, nostalgic contemplation. Fine strands of hair are delicately backlit, catching the ambient sunlight.";
            } else if (lowerSubject.includes("man") || lowerSubject.includes("guy") || lowerSubject.includes("male")) {
                return "He wears a well-worn leather jacket and sits in the dim light of a roadside diner. The scene features deep, warm shadows cast by Venetian blinds. Visible stubble and tired eyes convey a sense of long travel. The texture of the cracked leather is highly emphasized.";
            } else if (lowerSubject.includes("city") || lowerSubject.includes("building") || lowerSubject.includes("street")) {
                return "The perspective is taken from above, looking down on a labyrinthine network of neon signs and rain-slicked concrete. The atmosphere is dense with fog and artificial light. Extreme architectural detail in the background, with a sense of immense, suffocating scale.";
            } else {
                return "Add extra atmospheric depth with rich textures like polished stone and weathered wood. Include subtle depth of field (DOF) to focus the viewer's eye. The environment is vibrant, featuring saturated colors and soft, inviting light sources that create a pleasant and dreamlike quality.";
            }
        }


        function enhancePromptInstantly() {
            const subject = promptData.subject.trim();
            if (!subject) {
                showMessage("Please enter the main subject in Step 1 before enhancing.", 'error');
                return;
            }


            aiEnhancementText = generateMockEnhancementText(subject);
            showMessage('AI Enhancement added instantly!', 'info');
            
            // Re-render UI to display the new enhanced prompt
            updateUI();
        }


        // --- UI Rendering Functions ---


        function renderStepContent() {
            let html = '';
            const step = STEPS_CONFIG.find(c => c.id === currentStep);


            switch (currentStep) {
                case 1:
                    html = `
                        <h3 class="text-sm font-weight: bold; color: #6b7280; margin-bottom: 8px;">${step.title}</h3>
                        <div class="form-group">
                            <label for="subject">Who or what is the main subject? (Required)</label>
                            <input type="text" id="subject" value="${promptData.subject}" oninput="updatePromptData(event)" placeholder="e.g., A silver dragon, A single rose">
                        </div>
                        <div class="form-group">
                            <label for="action">What is the subject doing/where is it?</label>
                            <input type="text" id="action" value="${promptData.action}" oninput="updatePromptData(event)" placeholder="e.g., soaring over a stormy sea, eating chips in his bedroom">
                        </div>
                    `;
                    break;
                case 2:
                    html = `
                        <h3 class="text-sm font-weight: bold; color: #6b7280; margin-bottom: 8px;">${step.title}</h3>
                        <p>How do you want the image to look? (Choose one or add your own)</p>
                        <div class="radio-grid">
                            <input type="radio" id="style-photo" name="medium" value="professional photography, detailed, photorealistic" onchange="updatePromptData(event)" ${promptData.medium === 'professional photography, detailed, photorealistic' ? 'checked' : ''}>
                            <label for="style-photo">Photography</label>
                            
                            <input type="radio" id="style-art" name="medium" value="digital painting, highly detailed, fantasy art" onchange="updatePromptData(event)" ${promptData.medium === 'digital painting, highly detailed, fantasy art' ? 'checked' : ''}>
                            <label for="style-art">Digital Painting</label>
                            
                            <input type="radio" id="style-3d" name="medium" value="3D render, Octane render, unreal engine" onchange="updatePromptData(event)" ${promptData.medium === '3D render, Octane render, unreal engine' ? 'checked' : ''}>
                            <label for="style-3d">3D Render (CGI)</label>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="customStyle">Custom Style/Medium:</label>
                            <textarea id="customStyle" rows="2" oninput="updatePromptData(event)" placeholder="e.g., inspired by Van Gogh, 8-bit pixel art">${promptData.customStyle}</textarea>
                        </div>
                    `;
                    break;
                case 3:
                    html = `
                        <h3 class="text-sm font-weight: bold; color: #6b7280; margin-bottom: 8px;">${step.title}</h3>
                        <p>Set the atmosphere and light. (Choose one or add your own)</p>
                        <div class="radio-grid">
                            <input type="radio" id="mood-cinematic" name="moodLighting" value="cinematic volumetric lighting, dramatic shadows" onchange="updatePromptData(event)" ${promptData.moodLighting === 'cinematic volumetric lighting, dramatic shadows' ? 'checked' : ''}>
                            <label for="mood-cinematic">Cinematic/Moody</label>
                            
                            <input type="radio" id="mood-golden" name="moodLighting" value="golden hour, warm, diffused sunlight" onchange="updatePromptData(event)" ${promptData.moodLighting === 'golden hour, warm, diffused sunlight' ? 'checked' : ''}>
                            <label for="mood-golden">Golden Hour</label>
                            
                            <input type="radio" id="mood-neon" name="moodLighting" value="neon glow, cyberpunk aesthetic" onchange="updatePromptData(event)" ${promptData.moodLighting === 'neon glow, cyberpunk aesthetic' ? 'checked' : ''}>
                            <label for="mood-neon">Neon/Cyberpunk</label>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="customLighting">Custom Lighting/Mood:</label>
                            <textarea id="customLighting" rows="2" oninput="updatePromptData(event)" placeholder="e.g., strong rim light, single